echo Move to $HOME folder
cd $HOME

echo Clone bare repo
git clone --bare git@github.com:zigotica/tilde.git $HOME/._dotfiles.git

echo Hide untracked files
/usr/bin/git --git-dir=$HOME/._dotfiles.git/ --work-tree=$HOME config status.showUntrackedFiles no

echo Add bare repo to .gitignore
echo ._dotfiles.git >> $HOME/.gitignore

echo backup current dotfiles
mv $HOME/.config $HOME/.config.bk
mv $HOME/.bash_profile $HOME/.bash_profile.bk
mv $HOME/.bashrc $HOME/.bashrc.bk
mv $HOME/.tmux.conf $HOME/.tmux.conf.bk
mv $HOME/readme.md $HOME/readme.md.bk

echo Checkout
/usr/bin/git --git-dir=$HOME/._dotfiles.git/ --work-tree=$HOME checkout

echo copy .ssh_bk encrypted files into .ssh and decrypt them
mkdir $HOME/.ssh
cp $HOME/.ssh_bk/* $HOME/.ssh/
ansible-vault decrypt $HOME/.ssh/*

echo Add active app to login items
osascript -e 'tell application "System Events" to make login item at end with properties {name: "active-app-qmk-layer-updater",path:"~/.config/bin/active-app-qmk-layer-updater/active-app-qmk-layer-updater.app", hidden:false}'

echo DONE
echo Note that some of these changes require a logout/restart to take effect
